import { NextRequest, NextResponse } from 'next/server'

/**
 * Auth middleware: protects all /dashboard/* routes.
 * For v1 MVP: auth check is disabled — all dashboard routes are open.
 * When auth is enabled: checks Supabase session cookie and redirects to /login if missing.
 */
export async function middleware(request: NextRequest) {
    const { pathname } = request.nextUrl

    // Define public routes that don't require authentication
    const publicPaths = ['/', '/login', '/how-it-works', '/pricing', '/get-started']
    const isPublicPath =
        publicPaths.includes(pathname) ||
        pathname.startsWith('/api/') ||
        pathname.startsWith('/_next/') ||
        pathname.includes('.')

    // Only protect /dashboard routes
    if (isPublicPath) {
        return NextResponse.next()
    }

    // --- AUTH DISABLED FOR V1 MVP ---
    // Uncomment the block below when Supabase Auth is configured.
    // const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL
    // const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY
    //
    // if (!supabaseUrl || !supabaseAnonKey) {
    //     // Missing env vars — skip auth (dev mode)
    //     return NextResponse.next()
    // }
    //
    // const { createClient } = await import('@supabase/supabase-js')
    // const supabase = createClient(supabaseUrl, supabaseAnonKey, {
    //     global: { headers: { cookie: request.headers.get('cookie') || '' } },
    // })
    //
    // const { data: { session } } = await supabase.auth.getSession()
    //
    // if (!session && pathname.startsWith('/dashboard')) {
    //     const loginUrl = new URL('/login', request.url)
    //     loginUrl.searchParams.set('redirect', pathname)
    //     return NextResponse.redirect(loginUrl)
    // }

    return NextResponse.next()
}

export const config = {
    matcher: ['/dashboard/:path*'],
}
